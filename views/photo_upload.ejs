<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.iframe-transport.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.fileupload.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.cloudinary.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  </head>
  <body>
    <h1><%= title %></h1>


<p id="upload_widget_opener"> </p>

  <script src="//widget.cloudinary.com/global/all.js" type="text/javascript"></script>

  <!-- upload images to cloudinary -->
  <script type="text/javascript">

    var Photo = function(url) {
      this.faceIds = [];
      this.faceCoordinates = [];
      this.mainUrl = url;
    };

    var CollectionOfPhotos = function() {
      this.targetPhotoId = '';
      this.allFaceIds = [];
      this.allUrls = [];

      var that = this;

      return {
        addTargetPhoto: function(photo) {
          that.targetPhotoId = photo.faceId[0];
        },
        addPhoto: function(photo) {
          that.allUrls.push(photo.mainUrl);
          that.allFaceIds.concat(photo.faceIds)
        },
        getPhotos: function() {
          return that.allUrls;
        }
      }
    };

    $('#upload_widget_opener').cloudinary_upload_widget(
      { cloud_name: 'isityou', upload_preset: 'get_faces',
      'folder': 'get_faces', theme: 'minimal', thumbnail_transformation: { width: 200, height: 200, crop: 'limit' } },
      function(error, result) {
        var userPhotoCollection = new CollectionOfPhotos();
        result.forEach(function(photoFromCloudinary) {
          userPhotoCollection.addPhoto(photoFromCloudinary);
        });
      }
    );
  </script>

  <script type="text/javascript" src="/javascripts/main.js"></script>

  </body>
</html>
